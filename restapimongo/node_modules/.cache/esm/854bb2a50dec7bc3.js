let AsyncWrapper;_0de‍.w("../utils",[["AsyncWrapper",["AsyncWrapper"],function(v){AsyncWrapper=v}]]);require = require("esm") (module);



const express = require ('express');
const postrouter = express.Router();

//import th model
const Product = require('../models/Product');


    //GET A PRODUCT
    postrouter.get('/:pid',async (req,res)=> {
         
        const prodId  = req.params.pid;
        _0de‍.g.console.log("product Id "+prodId);

        try{
             const allProducts = await Product.findById(prodId);
             
             allProducts != null ? res.status(200).json(allProducts) : next(errorHandler("Product not available",422));

            //  id==1 ? res.json(`update contact ${id}`) : next(errorHandler("unknown contact",422));

             //res.json(allProducts);
             //res.status(200).json(allProducts);

        }catch(err) {
            res.status(500).json({message: err});
        }
      });

//GET ALL PRODUCTS
      postrouter.get('/',async (req,res)=> {
      try{
           const allProducts = await Product.find();
           res.status(200).json(allProducts);
      }catch(err) {
        res.status(500).json({message: err});
      }
    });
    //POST A PRODUCT
    postrouter.post('/',async (req,res) => {
        _0de‍.g.console.log(req.body);
        const product = new Product (
            {
                 productName: req.body.productName,
                 productPrice: req.body.productPrice   ,
                 productId: req.body.productId,
            }
        );
        try{
            const savedPost = await product.save();
            res.status(201).json({message: "record is created"});
        }catch(err) {
            res.status(500).json({message: err});
        }
        
     });
     
    //delete a product
     postrouter.delete('/:pid',async (req,res)=> {
        try{
             const deletedProduct = await Product.remove({_id: req.params.pid});
             res.status(200).json({message: "record is deleted"});
             
        }catch(err) {
            res.status(500).json({message: err});
        }
      });
    
     //update the product
     postrouter.patch('/:pid',async (req,res)=> {
        try{
             const deletedProduct = await Product.updateOne({_id: req.params.pid}, {$set: {productPrice:req.body.productPrice}});
             res.status(200).json({message: "record is updated"});
             
        }catch(err) {
            res.status(500).json({message: err});
        }
      });
     
module.exports = postrouter;